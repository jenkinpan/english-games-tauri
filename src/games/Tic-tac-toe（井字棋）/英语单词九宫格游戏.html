<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è‹±è¯­å•è¯ä¹å®«æ ¼æ¸¸æˆ</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        color: white;
      }

      .title-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 40px; /* ç¡®ä¿é«˜åº¦è¶³å¤Ÿï¼Œæ¯”å¦‚ 32px æˆ– 40px */
        z-index: 99999; /* ã€å…³é”®ã€‘æå¤§å€¼ï¼Œç¡®ä¿è¦†ç›–æ‰€æœ‰å†…å®¹ */
        background: transparent; /* è°ƒè¯•æ—¶å¯æ”¹ä¸º red */
        cursor: default; /* é¿å…è¯¯å¯¼ï¼Œæ™®é€šæŒ‡é’ˆå³å¯ */

        /* å¿…é¡»åˆ é™¤ä¸‹é¢è¿™ä¸€è¡Œ Electron ä¸“ç”¨ä»£ç  */
        /* -webkit-app-region: drag; */
      }

      .container {
        max-width: 1200px;
        width: 100%;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        margin-top: 20px;
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 2.5rem;
        color: #ffd700;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      }

      .subtitle {
        text-align: center;
        margin-bottom: 30px;
        color: #ccc;
        font-size: 1.1rem;
      }

      .back-home-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        color: #1a2a6c;
        border: none;
        padding: 0;
        font-size: 1.5rem;
        border-radius: 50%;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        transition: all 0.3s ease;
        z-index: 1000;
        opacity: 0.5;
      }

      .back-home-btn:hover {
        opacity: 1;
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6);
      }

      .back-home-btn:active {
        transform: translateY(1px);
      }

      .game-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: center;
      }

      .left-panel {
        flex: 1.5;
        min-width: 400px;
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
      }

      .right-panel {
        flex: 1;
        min-width: 300px;
      }

      .board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 12px;
        max-width: 500px;
        margin: 0 auto;
      }

      .cell {
        aspect-ratio: 1;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        color: white;
        text-align: center;
        padding: 15px;
        word-break: keep-all;
      }

      .cell:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-3px);
      }

      .cell.white {
        background: #ffffff;
        color: #333;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
      }

      .cell.black {
        background: #222;
        color: #fff;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
      }

      .cell.winning {
        animation: winPulse 0.6s ease-in-out infinite;
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        transform: scale(1.1);
      }

      @keyframes winPulse {
        0% {
          box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
          transform: scale(1.1);
        }

        50% {
          box-shadow: 0 0 40px rgba(255, 215, 0, 1);
          transform: scale(1.15);
        }

        100% {
          box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
          transform: scale(1.1);
        }
      }

      .win-celebration {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 999;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #ffd700;
        animation: confettiFall 3s linear forwards;
      }

      @keyframes confettiFall {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 1;
        }

        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      .controls {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        justify-content: center;
      }

      .word-manager {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .word-manager h4 {
        color: #ffd700;
        margin-bottom: 15px;
        text-align: center;
      }

      .word-manager-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .word-manager-buttons {
        display: flex;
        gap: 10px;
      }

      .word-inputs-container {
        transition:
          max-height 0.5s ease,
          padding 0.5s ease,
          margin 0.5s ease;
        max-height: 1000px;
        overflow: hidden;
      }

      .word-inputs-container.hidden {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
      }

      .btn-toggle-word-input {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        background: linear-gradient(90deg, #ffa62e, #ff3c38);
      }

      .btn-toggle-word-input:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(255, 166, 46, 0.4);
      }

      .btn-add-word-input,
      .btn-remove-word-input {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .btn-add-word-input {
        background: linear-gradient(90deg, #4facfe, #00f2fe);
      }

      .btn-add-word-input:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(79, 172, 254, 0.4);
      }

      .btn-remove-word-input {
        background: linear-gradient(90deg, #fa709a, #fee140);
      }

      .btn-remove-word-input:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(250, 112, 154, 0.4);
      }

      .word-inputs-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .word-input-group {
        display: flex;
        flex-direction: column;
      }

      .word-input-group label {
        margin-bottom: 5px;
        font-weight: bold;
        color: #ffd700;
        font-size: 0.9rem;
      }

      .word-input {
        padding: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #ffd700;
        border-radius: 5px;
        color: white;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        width: 100%;
        box-sizing: border-box;
      }

      .word-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .word-input:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        background: rgba(255, 255, 255, 0.15);
      }

      .word-count {
        text-align: center;
        color: #ccc;
        font-size: 0.9rem;
        margin-top: 15px;
      }

      .word-count.highlight {
        color: #ffd700;
        font-weight: bold;
      }

      @media (max-width: 768px) {
        .word-inputs-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .word-inputs-grid {
          grid-template-columns: 1fr;
        }
      }

      .btn {
        padding: 12px 20px;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        background: linear-gradient(90deg, #ff8a00, #ff0080);
        color: white;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      }

      .btn:active {
        transform: translateY(1px);
      }

      .btn-restart {
        background: linear-gradient(90deg, #00c9ff, #92fe9d);
      }

      .btn-next-round {
        background: linear-gradient(90deg, #9b59b6, #3498db);
      }

      .status {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        padding: 15px;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 10px;
      }

      .player {
        text-align: center;
        padding: 10px 20px;
        border-radius: 10px;
        min-width: 120px;
      }

      .player.active {
        background: rgba(255, 215, 0, 0.2);
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        border: 2px solid #ffd700;
      }

      .player.white .indicator {
        display: inline-block;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        margin-right: 10px;
        vertical-align: middle;
        box-shadow: 0 0 8px white;
      }

      .player.black .indicator {
        display: inline-block;
        width: 20px;
        height: 20px;
        background: black;
        border-radius: 50%;
        margin-right: 10px;
        vertical-align: middle;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
        border: 1px solid #555;
      }

      .scoreboard {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
      }

      .scoreboard h3 {
        color: #ffd700;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.5rem;
        position: relative;
        display: inline-block;
        padding: 0 20px;
        left: 50%;
        transform: translateX(-50%);
      }

      .scoreboard h3:after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, transparent, #ffd700, transparent);
      }

      .scoreboard ul {
        list-style: none;
        padding: 0;
        margin: 20px 0;
      }

      .scoreboard ul.scrollable {
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 10px;
      }

      .scoreboard ul.scrollable::-webkit-scrollbar {
        width: 8px;
      }

      .scoreboard ul.scrollable::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
      }

      .scoreboard ul.scrollable::-webkit-scrollbar-thumb {
        background: rgba(255, 215, 0, 0.5);
        border-radius: 10px;
      }

      .scoreboard ul.scrollable::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 215, 0, 0.7);
      }

      .scoreboard li {
        margin-bottom: 15px;
        padding: 12px 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        display: flex;
        align-items: center;
        animation: slideIn 0.5s ease forwards;
        opacity: 0;
        transform: translateY(20px);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .scoreboard li:hover {
        transform: translateY(-3px);
        background: rgba(0, 0, 0, 0.4);
      }

      .scoreboard li:before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
      }

      .scoreboard li.white-win:before {
        background: white;
        box-shadow: 0 0 10px white;
      }

      .scoreboard li.black-win:before {
        background: black;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
      }

      .scoreboard li.draw:before {
        background: linear-gradient(to bottom, white 50%, black 50%);
      }

      .score-icon {
        margin-right: 12px;
        font-size: 1.5rem;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        flex-shrink: 0;
      }

      .white-win .score-icon {
        background: white;
        color: #333;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      .black-win .score-icon {
        background: #222;
        color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }

      .draw .score-icon {
        background: linear-gradient(135deg, #555, #888);
        color: white;
      }

      .score-content {
        flex-grow: 1;
      }

      .score-content .round {
        font-weight: bold;
        color: #ffd700;
        margin-bottom: 5px;
      }

      .score-content .winner {
        font-size: 1.1rem;
      }

      .stats-container {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
        gap: 15px;
      }

      .stat-card {
        flex: 1;
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.3);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-card.white-stats {
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .stat-card.black-stats {
        border: 2px solid rgba(0, 0, 0, 0.5);
      }

      .stat-card.draw-stats {
        border: 2px solid rgba(150, 150, 150, 0.5);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin: 10px 0;
        color: #ffd700;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #ccc;
      }

      .progress-container {
        margin: 25px 0;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
      }

      .progress-title {
        text-align: center;
        margin-bottom: 15px;
        color: #ffd700;
      }

      .progress-bar {
        height: 20px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
      }

      .white-progress {
        height: 100%;
        background: linear-gradient(90deg, #f0f0f0, #ffffff);
        width: 0;
        transition: width 1s ease;
        border-radius: 10px 0 0 10px;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      .black-progress {
        height: 100%;
        background: linear-gradient(90deg, #333, #000);
        width: 0;
        transition: width 1s ease;
        border-radius: 0 10px 10px 0;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }

      .progress-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 0.9rem;
      }

      #final-result {
        text-align: center;
        padding: 15px;
        background: rgba(255, 215, 0, 0.1);
        border-radius: 10px;
        margin-top: 20px;
        font-size: 1.3rem;
        font-weight: bold;
        color: #ffd700;
        animation: pulse 2s infinite;
        border: 2px solid rgba(255, 215, 0, 0.3);
      }

      .game-rules {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
      }

      .game-rules h3 {
        color: #ffd700;
        margin-bottom: 10px;
      }

      .win-message {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
      }

      .win-message.show {
        opacity: 1;
        pointer-events: all;
      }

      .win-content {
        background: linear-gradient(135deg, #1a2a6c, #b21f1f);
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
        transform: scale(0.8);
        transition: transform 0.5s ease;
      }

      .win-message.show .win-content {
        transform: scale(1);
      }

      .win-content h2 {
        font-size: 3rem;
        margin-bottom: 20px;
        color: #ffd700;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
      }

      .win-content p {
        font-size: 1.5rem;
        margin-bottom: 30px;
      }

      .highlight {
        color: #ffd700;
        font-weight: bold;
      }

      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        50% {
          box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        100% {
          box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
      }

      @keyframes medalSpin {
        0% {
          transform: rotateY(0) scale(0.5);
        }

        50% {
          transform: rotateY(180deg) scale(1.2);
        }

        100% {
          transform: rotateY(360deg) scale(1);
        }
      }

      .medal {
        display: inline-block;
        font-size: 2rem;
        margin: 0 5px;
        animation: medalSpin 1.5s ease-out forwards;
      }

      @media (max-width: 768px) {
        .game-container {
          flex-direction: column;
        }

        .board {
          max-width: 100%;
        }

        .cell {
          font-size: 1.5rem;
        }

        .stats-container {
          flex-direction: column;
        }
      }
    </style>
  </head>

  <body>
    <a href="../../index.html" class="back-home-btn">ğŸ </a>
    <div class="title-bar" data-tauri-drag-region></div>
    <h1>è‹±è¯­å•è¯ä¹å®«æ ¼æ¸¸æˆ</h1>
    <div class="container">
      <div class="game-container">
        <div class="left-panel">
          <div class="status">
            <div class="player white active" id="player-white">
              <span class="indicator"></span
              ><span id="white-player-name">ç™½æ£‹å›åˆ</span>
            </div>
            <div class="player black" id="player-black">
              <span class="indicator"></span
              ><span id="black-player-name">é»‘æ£‹å›åˆ</span>
            </div>
          </div>

          <div class="board" id="board">
            <div class="cell" data-index="0">show</div>
            <div class="cell" data-index="1">take</div>
            <div class="cell" data-index="2">send</div>
            <div class="cell" data-index="3">in front of</div>
            <div class="cell" data-index="4">careful</div>
            <div class="cell" data-index="5">drop</div>
            <div class="cell" data-index="6">vase</div>
            <div class="cell" data-index="7">flower</div>
            <div class="cell" data-index="8">make a bookcase</div>
          </div>

          <div class="controls">
            <button id="restart-btn" class="btn btn-restart">
              é‡æ–°å¼€å§‹æ¸¸æˆ
            </button>
            <button id="next-round-btn" class="btn btn-next-round">
              ä¸‹ä¸€å›åˆ
            </button>
          </div>
        </div>

        <div class="right-panel">
          <div class="scoreboard">
            <h3>ğŸ† è®¡åˆ†æ¿ ğŸ†</h3>

            <div class="progress-container">
              <div class="progress-title">èƒœè´Ÿè¿›åº¦</div>
              <div class="progress-bar">
                <div
                  class="white-progress"
                  id="white-progress"
                  style="width: 0%"
                ></div>
                <div
                  class="black-progress"
                  id="black-progress"
                  style="width: 0%"
                ></div>
              </div>
              <div class="progress-labels">
                <span>ç™½æ£‹: <span id="white-percent">0%</span></span>
                <span>é»‘æ£‹: <span id="black-percent">0%</span></span>
              </div>
            </div>

            <div class="stats-container">
              <div class="stat-card white-stats">
                <div class="stat-label">ç™½æ£‹èƒœ</div>
                <div class="stat-value" id="white-wins">0</div>
                <div>å›åˆ</div>
              </div>
              <div class="stat-card draw-stats">
                <div class="stat-label">å¹³å±€</div>
                <div class="stat-value" id="draws">0</div>
                <div>å›åˆ</div>
              </div>
              <div class="stat-card black-stats">
                <div class="stat-label">é»‘æ£‹èƒœ</div>
                <div class="stat-value" id="black-wins">0</div>
                <div>å›åˆ</div>
              </div>
            </div>

            <ul id="round-results"></ul>
            <p id="final-result"></p>
          </div>

          <div class="word-manager">
            <div class="word-manager-header">
              <h4 style="margin: 0">ğŸ“ æ·»åŠ å•è¯ (è‡³å°‘9ä¸ª)</h4>
              <div class="word-manager-buttons">
                <button
                  id="toggle-word-input-btn"
                  class="btn-toggle-word-input"
                >
                  éšè—
                </button>
                <button id="add-word-input-btn" class="btn-add-word-input">
                  å¢åŠ 
                </button>
                <button
                  id="remove-word-input-btn"
                  class="btn-remove-word-input"
                >
                  å‡å°‘
                </button>
              </div>
            </div>
            <div class="word-inputs-container" id="word-inputs-container">
              <div class="word-inputs-grid" id="word-inputs-grid"></div>
              <div class="word-count" id="word-count">å½“å‰å•è¯æ•°: 0</div>
            </div>
          </div>

          <div class="game-rules">
            <h3>æ¸¸æˆè§„åˆ™è¯´æ˜</h3>
            <p>1. åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­æ·»åŠ è‡³å°‘9ä¸ªè‹±è¯­å•è¯ï¼Œå›åˆæ•°ä¾å•è¯æ•°è€Œå®šã€‚</p>
            <p>2. å°†å­¦ç”Ÿåˆ†ä¸ºç™½æ£‹ç»„å’Œé»‘æ£‹ç»„ï¼Œå­¦ç”Ÿè½®æµç‚¹å‡»æ ¼å­ä¸‹æ£‹ã€‚</p>
            <p>3. ä¸‹æ£‹å‰å¿…é¡»å‡†ç¡®è¯»å‡ºå•è¯å¹¶è¯´å‡ºä¸­æ–‡é‡Šä¹‰ã€‚</p>
            <p>4. å¦‚æœè¿æˆä¸‰ä¸ªæ£‹å­ï¼Œåˆ™å½“å‰å›åˆèƒœå‡ºã€‚</p>
            <p>5. ä¸ºä¿è¯å…¬å¹³ï¼Œæ¯ä¸€å›åˆè‡ªåŠ¨åˆ‡æ¢å…ˆæ‰‹ç©å®¶ã€‚</p>
            <p>6. æ‰€æœ‰å›åˆç»“æŸåï¼Œä¼šå±•ç¤ºæœ€ç»ˆè·èƒœæ–¹ã€‚</p>
          </div>
        </div>
      </div>
    </div>

    <div class="win-message" id="win-message">
      <div class="win-content">
        <h2>æ¸¸æˆç»“æŸ</h2>
        <p id="win-text">æ­å–œG1è·èƒœï¼</p>
        <button id="close-win" class="btn">ç»§ç»­æ¸¸æˆ</button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Game state
        const gameState = {
          currentPlayer: "white",
          board: Array(9).fill(null),
          gameOver: false,
          allWords: [],
          currentRound: 0,
          whiteWins: 0,
          blackWins: 0,
          draws: 0,
          roundResults: [],
          whitePlayerName: "ç™½æ£‹",
          blackPlayerName: "é»‘æ£‹",
        };

        // DOM elements
        const boardElement = document.getElementById("board");
        const playerWhite = document.getElementById("player-white");
        const playerBlack = document.getElementById("player-black");
        const restartBtn = document.getElementById("restart-btn");
        const nextRoundBtn = document.getElementById("next-round-btn");
        const winMessage = document.getElementById("win-message");
        const winText = document.getElementById("win-text");
        const closeWin = document.getElementById("close-win");
        const wordInputsGrid = document.getElementById("word-inputs-grid");
        const wordInputsContainer = document.getElementById(
          "word-inputs-container",
        );
        const addWordInputBtn = document.getElementById("add-word-input-btn");
        const removeWordInputBtn = document.getElementById(
          "remove-word-input-btn",
        );
        const toggleWordInputBtn = document.getElementById(
          "toggle-word-input-btn",
        );
        const wordCount = document.getElementById("word-count");
        const roundResults = document.getElementById("round-results");

        let wordInputCount = 9; // é»˜è®¤9ä¸ªè¾“å…¥æ¡†
        let isWordInputHidden = false; // æ˜¯å¦éšè—å•è¯è¾“å…¥åŒº
        const finalResult = document.getElementById("final-result");
        const whiteWinsElement = document.getElementById("white-wins");
        const blackWinsElement = document.getElementById("black-wins");
        const drawsElement = document.getElementById("draws");
        const whiteProgress = document.getElementById("white-progress");
        const blackProgress = document.getElementById("black-progress");
        const whitePercent = document.getElementById("white-percent");
        const blackPercent = document.getElementById("black-percent");
        const whitePlayerNameSpan =
          document.getElementById("white-player-name");
        const blackPlayerNameSpan =
          document.getElementById("black-player-name");

        // Function to update player names
        function updatePlayerNames() {
          whitePlayerNameSpan.textContent = `${gameState.whitePlayerName}å›åˆ`;
          blackPlayerNameSpan.textContent = `${gameState.blackPlayerName}å›åˆ`;
        }

        // Initialize the board
        function initBoard() {
          boardElement.innerHTML = "";
          const currentWords = [];
          const totalWords = gameState.allWords.length;
          for (let i = 0; i < 9; i++) {
            const index = (gameState.currentRound * 9 + i) % totalWords;
            currentWords.push(gameState.allWords[index]);
          }
          for (let i = 0; i < 9; i++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.index = i;
            cell.textContent = currentWords[i] || `å•è¯ ${i + 1}`;
            // åªæœ‰åœ¨æ¸¸æˆæœªç»“æŸæ—¶æ‰å…è®¸ç‚¹å‡»
            if (!gameState.gameOver) {
              cell.addEventListener("click", () => makeMove(i));
            } else {
              // æ¸¸æˆç»“æŸåï¼Œæ·»åŠ ç¦ç”¨æ ·å¼
              cell.style.cursor = "not-allowed";
              cell.style.opacity = "0.6";
            }
            if (gameState.board[i]) {
              cell.classList.add(gameState.board[i]);
            }
            boardElement.appendChild(cell);
          }
        }

        // Make a move
        function makeMove(index) {
          // å¦‚æœæ¸¸æˆå·²ç»“æŸæˆ–è¯¥ä½ç½®å·²æœ‰æ£‹å­ï¼Œåˆ™ä¸å…è®¸ä¸‹æ£‹
          if (gameState.gameOver || gameState.board[index]) {
            return;
          }

          // Update game state
          gameState.board[index] = gameState.currentPlayer;
          const cell = document.querySelector(`.cell[data-index="${index}"]`);
          cell.classList.add(gameState.board[index]);

          // Play sound effect
          playSound("click");

          // Check for win
          const winningPattern = checkWin();
          if (winningPattern) {
            gameState.gameOver = true;
            const winner =
              gameState.currentPlayer === "white"
                ? gameState.whitePlayerName
                : gameState.blackPlayerName;
            updateScore(winner);

            // æ’­æ”¾è·èƒœéŸ³æ•ˆ
            playSound("win");

            // é«˜äº®æ˜¾ç¤ºè·èƒœçš„æ ¼å­
            highlightWinningCells(winningPattern);

            // åˆ›å»ºåº†ç¥ç‰¹æ•ˆï¼ˆå½©å¸¦ï¼‰
            createConfetti();

            return;
          }

          // Check for draw
          if (!gameState.board.includes(null)) {
            gameState.gameOver = true;
            updateScore("å¹³å±€");
            playSound("draw");
            return;
          }

          // Switch player
          gameState.currentPlayer =
            gameState.currentPlayer === "white" ? "black" : "white";
          updatePlayerStatus();
        }

        // Audio context for sound effects
        let audioContext = null;

        function ensureAudioContext() {
          if (!audioContext) {
            audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
          }
          if (audioContext.state === "suspended") {
            audioContext.resume();
          }
        }

        // Play sound effects
        function playSound(type) {
          ensureAudioContext();

          if (type === "click") {
            // ç‚¹å‡»éŸ³æ•ˆ - æ¸…è„†çš„æç¤ºéŸ³
            playTone(440, 0.1, "sine");
          } else if (type === "win") {
            // è·èƒœéŸ³æ•ˆ - èƒœåˆ©çš„éŸ³ç¬¦åºåˆ—
            const frequencies = [523.25, 659.25, 783.99, 1046.5]; // C5, E5, G5, C6
            frequencies.forEach((freq, index) => {
              setTimeout(() => {
                playTone(freq, 0.2, "sine");
              }, index * 100);
            });
          } else if (type === "draw") {
            // å¹³å±€éŸ³æ•ˆ - ä¸­æ€§çš„éŸ³è°ƒ
            playTone(330, 0.3, "sine");
          }
        }

        // Play a single tone
        function playTone(frequency, duration, type = "sine") {
          ensureAudioContext();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = type;

          gainNode.gain.setValueAtTime(0, audioContext.currentTime);
          gainNode.gain.linearRampToValueAtTime(
            0.3,
            audioContext.currentTime + 0.01,
          );
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + duration,
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        }

        // Check for winning condition and return winning pattern
        function checkWin() {
          const winPatterns = [
            [0, 1, 2],
            [3, 4, 5],
            [6, 7, 8],
            [0, 3, 6],
            [1, 4, 7],
            [2, 5, 8],
            [0, 4, 8],
            [2, 4, 6],
          ];

          for (const pattern of winPatterns) {
            const [a, b, c] = pattern;
            if (
              gameState.board[a] &&
              gameState.board[a] === gameState.board[b] &&
              gameState.board[a] === gameState.board[c]
            ) {
              return pattern; // è¿”å›è·èƒœçš„æ ¼å­ç´¢å¼•
            }
          }
          return null; // æ²¡æœ‰è·èƒœ
        }

        // Create confetti effect
        function createConfetti() {
          const colors = [
            "#ffd700",
            "#ff6b6b",
            "#4ecdc4",
            "#45b7d1",
            "#96ceb4",
            "#ffeaa7",
          ];
          const confettiCount = 50;

          for (let i = 0; i < confettiCount; i++) {
            setTimeout(() => {
              const confetti = document.createElement("div");
              confetti.className = "confetti";
              confetti.style.left = Math.random() * 100 + "%";
              confetti.style.background =
                colors[Math.floor(Math.random() * colors.length)];
              confetti.style.animationDelay = Math.random() * 0.5 + "s";
              confetti.style.width = Math.random() * 10 + 5 + "px";
              confetti.style.height = confetti.style.width;
              document.body.appendChild(confetti);

              setTimeout(() => {
                confetti.remove();
              }, 3000);
            }, i * 20);
          }
        }

        // Highlight winning cells
        function highlightWinningCells(pattern) {
          pattern.forEach((index) => {
            const cell = document.querySelector(`.cell[data-index="${index}"]`);
            if (cell) {
              cell.classList.add("winning");
            }
          });
        }

        // Update player status display
        function updatePlayerStatus() {
          if (gameState.currentPlayer === "white") {
            playerWhite.classList.add("active");
            playerBlack.classList.remove("active");
          } else {
            playerBlack.classList.add("active");
            playerWhite.classList.remove("active");
          }
        }

        // Reset the game
        function resetGame() {
          // æ ¹æ®å½“å‰å›åˆæ•°å†³å®šå…ˆæ‰‹ç©å®¶
          gameState.currentPlayer =
            gameState.currentRound % 2 === 0 ? "white" : "black";
          gameState.board = Array(9).fill(null);
          gameState.gameOver = false;

          // ç§»é™¤æ‰€æœ‰è·èƒœæ ¼å­çš„é«˜äº®æ•ˆæœ
          document.querySelectorAll(".cell.winning").forEach((cell) => {
            cell.classList.remove("winning");
          });

          updatePlayerStatus();
          initBoard();
        }

        // LocalStorage functions
        function saveToLocalStorage() {
          const words = [];
          for (let i = 1; i <= wordInputCount; i++) {
            const input = document.getElementById(`word-${i}`);
            words.push(input ? input.value : "");
          }
          const dataToSave = {
            words: words,
            wordCount: wordInputCount,
            isWordInputHidden: isWordInputHidden,
          };
          try {
            localStorage.setItem("wordGridGame", JSON.stringify(dataToSave));
          } catch (err) {
            console.error("Failed to save to localStorage:", err);
          }
        }

        function loadFromLocalStorage() {
          try {
            const saved = localStorage.getItem("wordGridGame");
            if (saved) return JSON.parse(saved);
          } catch (err) {
            console.error("Failed to load from localStorage:", err);
          }
          return null;
        }

        // Create word input
        function createWordInput(index) {
          const i = index + 1;
          const inputGroup = document.createElement("div");
          inputGroup.className = "word-input-group";

          const label = document.createElement("label");
          label.textContent = `å•è¯ ${i}:`;

          const input = document.createElement("input");
          input.type = "text";
          input.className = "word-input";
          input.id = `word-${i}`;
          input.placeholder = `è¾“å…¥å•è¯ ${i}`;

          // ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œæ›´æ–°å•è¯åˆ—è¡¨å¹¶ä¿å­˜
          input.addEventListener("input", function () {
            updateWordsFromInputs();
            saveToLocalStorage();
          });

          inputGroup.appendChild(label);
          inputGroup.appendChild(input);
          wordInputsGrid.appendChild(inputGroup);
        }

        // Update words from all inputs
        function updateWordsFromInputs() {
          gameState.allWords = [];
          for (let i = 1; i <= wordInputCount; i++) {
            const input = document.getElementById(`word-${i}`);
            if (input && input.value.trim()) {
              const word = input.value.trim();
              // æ£€æŸ¥æ˜¯å¦é‡å¤
              if (!gameState.allWords.includes(word)) {
                gameState.allWords.push(word);
              }
            }
          }
          updateWordCount();
          updateGameState();
          // æ›´æ–°æ£‹ç›˜æ˜¾ç¤ºï¼Œä½¿å•è¯å˜åŒ–æ—¶æ£‹ç›˜ä¹Ÿéšä¹‹æ›´æ–°
          if (gameState.allWords.length > 0) {
            initBoard();
          }
        }

        // Update game state based on word count
        function updateGameState() {
          const count = gameState.allWords.length;
          nextRoundBtn.disabled = count < 9;

          if (count < 9) {
            // å¦‚æœå•è¯æ•°å°‘äº9ä¸ªï¼Œé‡ç½®æ¸¸æˆçŠ¶æ€
            if (
              gameState.whiteWins > 0 ||
              gameState.blackWins > 0 ||
              gameState.draws > 0
            ) {
              gameState.currentRound = 0;
              gameState.whiteWins = 0;
              gameState.blackWins = 0;
              gameState.draws = 0;
              gameState.roundResults = [];
              roundResults.innerHTML = "";
              finalResult.textContent = "";
              resetGame();
              whiteWinsElement.textContent = "0";
              blackWinsElement.textContent = "0";
              drawsElement.textContent = "0";
              updateProgressBar();
            }
          }
        }

        // Add word input
        function addWordInput() {
          wordInputCount++;
          createWordInput(wordInputCount - 1);
          updateWordsFromInputs();
          saveToLocalStorage();
        }

        // Remove word input
        function removeWordInput() {
          if (wordInputCount <= 1) {
            alert("è‡³å°‘éœ€è¦ä¿ç•™1ä¸ªå•è¯è¾“å…¥æ¡†ï¼");
            return;
          }

          const i = wordInputCount;
          const input = document.getElementById(`word-${i}`);
          if (input) {
            input.closest(".word-input-group").remove();
          }

          wordInputCount--;
          updateWordsFromInputs();
          saveToLocalStorage();
        }

        // Toggle word input visibility
        function toggleWordInputVisibility() {
          isWordInputHidden = !isWordInputHidden;
          updateWordInputVisibility();
          saveToLocalStorage();
        }

        function updateWordInputVisibility() {
          if (isWordInputHidden) {
            wordInputsContainer.classList.add("hidden");
            toggleWordInputBtn.textContent = "æ˜¾ç¤º";
          } else {
            wordInputsContainer.classList.remove("hidden");
            toggleWordInputBtn.textContent = "éšè—";
          }
        }

        // Update word count display
        function updateWordCount() {
          const count = gameState.allWords.length;
          wordCount.textContent = `å½“å‰å•è¯æ•°: ${count}`;
          if (count >= 9) {
            wordCount.classList.add("highlight");
          } else {
            wordCount.classList.remove("highlight");
          }
        }

        // Initialize word inputs
        function initializeWordInputs() {
          wordInputsGrid.innerHTML = "";
          for (let i = 0; i < wordInputCount; i++) {
            createWordInput(i);
          }
          updateWordsFromInputs();
        }

        // Event listeners
        addWordInputBtn.addEventListener("click", addWordInput);
        removeWordInputBtn.addEventListener("click", removeWordInput);
        toggleWordInputBtn.addEventListener("click", toggleWordInputVisibility);

        // Update score
        function updateScore(winner) {
          gameState.roundResults.push({
            round: gameState.currentRound + 1,
            winner: winner,
          });

          if (winner === gameState.whitePlayerName) {
            gameState.whiteWins++;
          } else if (winner === gameState.blackPlayerName) {
            gameState.blackWins++;
          } else {
            gameState.draws++;
          }

          updateScoreboard();
        }

        // Update scoreboard
        function updateScoreboard() {
          roundResults.innerHTML = "";

          // å¦‚æœæ¯”èµ›å±€æ•°è¶…è¿‡2å±€ï¼Œæ·»åŠ æ»šåŠ¨æ¡æ ·å¼
          if (gameState.roundResults.length > 2) {
            roundResults.classList.add("scrollable");
          } else {
            roundResults.classList.remove("scrollable");
          }

          gameState.roundResults.forEach((result, index) => {
            const li = document.createElement("li");

            // Add class based on winner
            if (result.winner === gameState.whitePlayerName) {
              li.classList.add("white-win");
            } else if (result.winner === gameState.blackPlayerName) {
              li.classList.add("black-win");
            } else {
              li.classList.add("draw");
            }

            // Set animation delay for staggered effect
            li.style.animationDelay = `${index * 0.1}s`;

            // Medal icon based on winner
            let icon = "â–";
            if (result.winner === gameState.whitePlayerName) icon = "ğŸ¥‡";
            if (result.winner === gameState.blackPlayerName) icon = "ğŸ¥ˆ";
            if (result.winner === "å¹³å±€") icon = "ğŸ¤";

            li.innerHTML = `
                        <div class="score-icon">${icon}</div>
                        <div class="score-content">
                            <div class="round">ç¬¬ ${result.round} å›åˆ</div>
                            <div class="winner">${result.winner} è·èƒœ</div>
                        </div>
                    `;

            roundResults.appendChild(li);
          });

          // Update stats
          whiteWinsElement.textContent = gameState.whiteWins;
          blackWinsElement.textContent = gameState.blackWins;
          drawsElement.textContent = gameState.draws;

          // Update progress bar
          updateProgressBar();

          // Final result message
          if (gameState.allWords.length <= (gameState.currentRound + 1) * 9) {
            let finalWinner;
            if (gameState.whiteWins > gameState.blackWins) {
              finalWinner = gameState.whitePlayerName;
            } else if (gameState.blackWins > gameState.whiteWins) {
              finalWinner = gameState.blackPlayerName;
            } else {
              finalWinner = "å¹³å±€";
            }
            finalResult.innerHTML = `ğŸ† æœ€ç»ˆè·èƒœæ–¹ï¼š<span class="highlight">${finalWinner}</span> ğŸ†`;
          } else {
            finalResult.textContent = "";
          }
        }

        // Update progress bar
        function updateProgressBar() {
          const totalRounds =
            gameState.whiteWins + gameState.blackWins + gameState.draws;

          if (totalRounds > 0) {
            const whitePercentValue = Math.round(
              (gameState.whiteWins / totalRounds) * 100,
            );
            const blackPercentValue = Math.round(
              (gameState.blackWins / totalRounds) * 100,
            );

            whiteProgress.style.width = `${whitePercentValue}%`;
            blackProgress.style.width = `${blackPercentValue}%`;

            whitePercent.textContent = `${whitePercentValue}%`;
            blackPercent.textContent = `${blackPercentValue}%`;
          } else {
            whiteProgress.style.width = "0%";
            blackProgress.style.width = "0%";
            whitePercent.textContent = "0%";
            blackPercent.textContent = "0%";
          }
        }

        // Event listeners
        restartBtn.addEventListener("click", function () {
          gameState.currentRound = 0;
          gameState.whiteWins = 0;
          gameState.blackWins = 0;
          gameState.draws = 0;
          gameState.roundResults = [];
          roundResults.innerHTML = "";
          finalResult.textContent = "";
          resetGame();

          // Reset stats
          whiteWinsElement.textContent = "0";
          blackWinsElement.textContent = "0";
          drawsElement.textContent = "0";
          updateProgressBar();
        });

        closeWin.addEventListener("click", function () {
          // åªå…³é—­è·èƒœæ¶ˆæ¯ï¼Œä¸é‡ç½®æ¸¸æˆçŠ¶æ€
          // æ¸¸æˆç»“æŸåä¸å…è®¸ç»§ç»­ä¸‹æ£‹ï¼Œåªèƒ½é€šè¿‡"é‡æ–°å¼€å§‹"æˆ–"ä¸‹ä¸€å›åˆ"ç»§ç»­
          winMessage.classList.remove("show");
          // ä¸é‡ç½® gameState.gameOverï¼Œä¿æŒæ¸¸æˆç»“æŸçŠ¶æ€
          // æ›´æ–°æ£‹ç›˜æ˜¾ç¤ºï¼Œç¦ç”¨æ‰€æœ‰æ ¼å­
          initBoard();
        });

        nextRoundBtn.addEventListener("click", function () {
          if (gameState.allWords.length >= 9) {
            gameState.currentRound++;
            resetGame();
          } else {
            alert("è¯·å…ˆæ·»åŠ è‡³å°‘9ä¸ªå•è¯ï¼");
          }
        });

        // Initialize the game
        initBoard();
        updatePlayerStatus();
        updatePlayerNames();

        // Load from localStorage
        const savedData = loadFromLocalStorage();
        if (savedData) {
          // æ¢å¤å•è¯è¾“å…¥æ¡†æ•°é‡
          if (
            typeof savedData.wordCount === "number" &&
            savedData.wordCount > 0
          ) {
            wordInputCount = savedData.wordCount;
          }

          // æ¢å¤éšè—çŠ¶æ€
          if (typeof savedData.isWordInputHidden === "boolean") {
            isWordInputHidden = savedData.isWordInputHidden;
          }

          updatePlayerNames();
        }

        // Initialize word inputs
        initializeWordInputs();

        // æ¢å¤å•è¯å†…å®¹
        if (savedData && Array.isArray(savedData.words)) {
          savedData.words.forEach((word, idx) => {
            const i = idx + 1;
            const input = document.getElementById(`word-${i}`);
            if (input) {
              input.value = word || "";
            }
          });
          updateWordsFromInputs();
        }

        // æ¢å¤éšè—çŠ¶æ€æ˜¾ç¤º
        updateWordInputVisibility();
      });
    </script>
  </body>
</html>
